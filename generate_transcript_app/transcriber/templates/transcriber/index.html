<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <title>Upload Media</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
  <div class="container text-center bg-secondary-subtle rounded pt-3 mt-5">
    <h1 class="mt-5">Upload Media File</h1>
    <div class="d-flex col-8 m-auto" style="height: 400px">
      <form method="post" enctype="multipart/form-data" class="m-auto border rounded p-3 align-self-center">
        <div class="mb-3">
          {% csrf_token %}
          {{ form.as_p }}
        </div>
        <div class="d-grid gap-2 mb-3">
          <!-- <div class="btn btn-lg btn-primary">Upload</button> -->
          <button type="submit" class="btn btn-lg btn-primary">Upload</button>
        </div>
        <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
          <div id="pbar" class="progress-bar" style="width: 0%"></div>
        </div>
      </form>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script type="text/javascript">
    const allowed_formats = ["mp4", "mp3", "ogg", "m4a"]
    $("button").click(() => {
      let pbar = $("#pbar")
      let id_file = $("#id_file")

      // confirm that the user submitted a file
      if (id_file.val() == "") {
        return
      }

      // confirm that the user submitted a file with valid format
      let file_ext = id_file.val().slice(id_file.val().length-3)
      if (!allowed_formats.includes(file_ext)) {
        alert("Allowed formats are:\n - " + allowed_formats.join("\n - "))
        id_file.val("")
        return
      }

      // fake pbar
      let pbar_interval = setInterval(pbar_progress, 2000)
      function pbar_progress() {
        let now = parseInt(pbar.attr("style").replace("%","").replace(" ","").split(":")[1])
        if (now < 100) {
          pbar.attr("style", "width: " + (now + 10) + "%")
        }
        if (now > 100) {
          pbar.attr("style", "width: 100%")
          clearInterval(pbar_interval)
        }
      }
    })
  </script>
</body>
</html>
